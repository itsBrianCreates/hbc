<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Human Behind The Curtain â€“ Sessions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="landing-body">
  <main class="landing">
    <header class="landing__header">
      <p class="eyebrow">Conversation Simulator</p>
      <h1>Human Behind The Curtain</h1>
      <p class="muted">Start a new session or join an existing one to chat as the manager or human behind the curtain.</p>
    </header>

    <section class="landing__card">
      <div class="landing__actions">
        <button id="startSession" class="primary-btn" type="button">Start New Session</button>
      </div>
      <div class="landing__join">
        <label for="joinId" class="muted">Join an existing session</label>
        <div class="join-input">
          <input id="joinId" type="text" placeholder="Paste session ID" />
          <button id="joinSession" class="secondary-btn" type="button">Join</button>
        </div>
      </div>
      <p class="muted small">Sessions are just shared IDs. Copy and share the link with the other participant.</p>
    </section>
  </main>

  <script>
    (function () {
      const startBtn = document.getElementById("startSession");
      const joinBtn = document.getElementById("joinSession");
      const joinInput = document.getElementById("joinId");

      function generateSessionId() {
        if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
        return "s_" + Math.random().toString(36).slice(2, 10);
      }

      function extractSessionId(input) {
        const trimmed = (input || "").trim();
        if (!trimmed) return "";
        try {
          const url = new URL(trimmed);
          const param = url.searchParams.get("session");
          if (param) return param;
        } catch (e) {
          // not a full URL, treat as raw id
        }
        return trimmed;
      }

      function goToSession(id) {
        const sessionId = extractSessionId(id);
        if (!sessionId) return;
        const base = "hbc/?session=" + encodeURIComponent(sessionId);
        window.location.href = base;
      }

      startBtn.addEventListener("click", () => {
        const id = generateSessionId();
        goToSession(id);
      });

      joinBtn.addEventListener("click", (e) => {
        e.preventDefault();
        goToSession(joinInput.value);
      });

      joinInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          joinBtn.click();
        }
      });
    })();
  </script>
</body>
</html>
